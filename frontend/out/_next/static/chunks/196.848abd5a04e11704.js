(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[196],{196:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var n=r(7876),o=r(4232),i=r(9099);let a=e=>{let{isOpen:t,onClose:r}=e,[a,s]=(0,o.useState)(!1),c=(0,i.useRouter)();return t?(0,n.jsx)("div",{className:"exit-modal-overlay",children:(0,n.jsxs)("div",{className:"exit-modal",children:[(0,n.jsx)("h2",{children:"Antes de sair"}),(0,n.jsx)("p",{children:"Ficou com alguma d\xfavida que a gente possa te ajudar?"}),(0,n.jsxs)("div",{className:"exit-modal-buttons",children:[(0,n.jsx)("button",{className:"exit-modal-button primary",onClick:()=>{a&&localStorage.setItem("dontShowExitModal","true"),r(),c.push("/#contact")},children:"Sim, tenho uma d\xfavida"}),(0,n.jsx)("button",{className:"exit-modal-button secondary",onClick:()=>{a&&localStorage.setItem("dontShowExitModal","true"),r()},children:"N\xe3o, tudo certo"})]}),(0,n.jsxs)("div",{className:"exit-modal-checkbox",children:[(0,n.jsx)("input",{type:"checkbox",id:"dontShowAgain",checked:a,onChange:()=>{s(!a)}}),(0,n.jsx)("label",{htmlFor:"dontShowAgain",children:"Por favor, n\xe3o me pergunte isso de novo. Obrigado."})]})]})}):null};var s=r(5364);let c={INTERVAL_MS:6e4,MAX_RETRIES:3,BACKOFF_BASE_MS:2e3,ENABLED:!0,DEBUG:!0},l=()=>{{let e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e)return"/api"}let e=s.env.NEXT_PUBLIC_BACKEND_URL;return e&&""!==e.trim()?e:"https://api.hera-i.com.br"},d=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.MAX_RETRIES;try{let n=await fetch(e,t);if(!n.ok&&r>0){let n=c.BACKOFF_BASE_MS*Math.pow(2,c.MAX_RETRIES-r);return await new Promise(e=>setTimeout(e,n)),d(e,t,r-1)}return n}catch(n){if(c.DEBUG&&console.error("Erro no fetch:",n),r>0){let n=c.BACKOFF_BASE_MS*Math.pow(2,c.MAX_RETRIES-r);return await new Promise(e=>setTimeout(e,n)),d(e,t,r-1)}return c.DEBUG&&console.error("Fetch failed after retries:",n),null}},u=()=>{let[e]=(0,o.useState)(c.ENABLED),[t,r]=(0,o.useState)(null),[i,s]=(0,o.useState)(!1),[u,m]=(0,o.useState)(!1),E=(0,o.useRef)(0),h=(0,o.useRef)(!1),f=(0,o.useRef)(""),v=(0,o.useRef)(!1);return((0,o.useEffect)(()=>{if(!v.current){v.current=!0;try{let e=localStorage.getItem("deviceId")||crypto.randomUUID();localStorage.setItem("deviceId",e),f.current=e;let t=new Date;r(t)}catch(e){c.DEBUG&&console.error("Erro ao inicializar VisitTracker:",e)}}},[]),(0,o.useEffect)(()=>{if(!t||!f.current)return;(async()=>{if(!h.current){h.current=!0;try{let e={device_id:f.current,timestamp:t.toISOString(),user_agent:navigator.userAgent,referrer:document.referrer||"direct"},r="".concat(l(),"/visit/register");await d(r,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},mode:"cors",credentials:"omit",body:JSON.stringify(e)})}catch(e){c.DEBUG&&console.error("Erro ao registrar visita:",e)}finally{h.current=!1}}})();let e=async()=>{if(!t||h.current)return;let e=Date.now();if(!(e-E.current<6e4)){h.current=!0,E.current=e;try{let e=new Date,r=e.getTime()-t.getTime(),n=Math.floor(r/1e3),o={device_id:f.current,time_spent_seconds:n,timestamp:e.toISOString()},i="".concat(l(),"/visit/time");await d(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},mode:"cors",credentials:"omit",body:JSON.stringify(o)})}catch(e){c.DEBUG&&console.error("Erro ao registrar tempo:",e)}finally{h.current=!1}}},r=()=>{if(navigator.sendBeacon&&t){let e=new Date,r=Math.floor((e.getTime()-t.getTime())/1e3),n={device_id:f.current,time_spent_seconds:r,timestamp:e.toISOString()},o="".concat(l(),"/visit/time");navigator.sendBeacon(o,JSON.stringify(n))}else e()};window.addEventListener("beforeunload",r),window.addEventListener("pagehide",r);let n=setInterval(()=>{e()},c.INTERVAL_MS);return()=>{window.removeEventListener("beforeunload",r),window.removeEventListener("pagehide",r),clearInterval(n),e()}},[t]),(0,o.useEffect)(()=>{if(!u||!c.ENABLED)return;let e=()=>"true"===localStorage.getItem("dontShowExitModal");if(e())return;let t=t=>{!e()&&t.clientY<=0&&s(!0)};return document.addEventListener("mouseleave",t),()=>{document.removeEventListener("mouseleave",t)}},[u]),(0,o.useEffect)(()=>{if(!c.ENABLED)return;let e=()=>{u||m(!0)};return document.addEventListener("click",e),document.addEventListener("scroll",e),()=>{document.removeEventListener("click",e),document.removeEventListener("scroll",e)}},[u]),e)?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(a,{isOpen:i,onClose:()=>s(!1)})}):null}},9099:(e,t,r)=>{e.exports=r(8253)}}]);