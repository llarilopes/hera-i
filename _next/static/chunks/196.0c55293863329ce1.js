(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[196],{196:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>u});var r=o(7876),n=o(4232),a=o(9099);let i=e=>{let{isOpen:t,onClose:o}=e,[i,c]=(0,n.useState)(!1),s=(0,a.useRouter)();return t?(0,r.jsx)("div",{className:"exit-modal-overlay",children:(0,r.jsxs)("div",{className:"exit-modal",children:[(0,r.jsx)("h2",{children:"Antes de sair"}),(0,r.jsx)("p",{children:"Ficou com alguma d\xfavida que a gente possa te ajudar?"}),(0,r.jsxs)("div",{className:"exit-modal-buttons",children:[(0,r.jsx)("button",{className:"exit-modal-button primary",onClick:()=>{i&&localStorage.setItem("dontShowExitModal","true"),o(),s.push("/#contact")},children:"Sim, tenho uma d\xfavida"}),(0,r.jsx)("button",{className:"exit-modal-button secondary",onClick:()=>{i&&localStorage.setItem("dontShowExitModal","true"),o()},children:"N\xe3o, tudo certo"})]}),(0,r.jsxs)("div",{className:"exit-modal-checkbox",children:[(0,r.jsx)("input",{type:"checkbox",id:"dontShowAgain",checked:i,onChange:()=>{c(!i)}}),(0,r.jsx)("label",{htmlFor:"dontShowAgain",children:"Por favor, n\xe3o me pergunte isso de novo. Obrigado."})]})]})}):null};var c=o(5364);let s={INTERVAL_MS:6e4,MAX_RETRIES:3,BACKOFF_BASE_MS:2e3,ENABLED:!0,DEBUG:!0},l=()=>{{let e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e)return s.DEBUG&&console.log("API Base URL (dev proxy): /api"),"/api"}let e=c.env.NEXT_PUBLIC_BACKEND_URL;if(e&&""!==e.trim())return s.DEBUG&&console.log("API Base URL (env):",e),e;let t="https://api.hera-i.com.br";return s.DEBUG&&console.log("API Base URL (fallback prod):",t),t},d=async function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.MAX_RETRIES;try{s.DEBUG&&console.log("Tentando fetch para ".concat(e),t);let r=await fetch(e,t);if(s.DEBUG&&console.log("Resposta do fetch: ".concat(r.status," ").concat(r.statusText)),!r.ok&&o>0){let r=s.BACKOFF_BASE_MS*Math.pow(2,s.MAX_RETRIES-o);return s.DEBUG&&console.log("Retry ".concat(s.MAX_RETRIES-o+1," for ").concat(e," after ").concat(r,"ms")),await new Promise(e=>setTimeout(e,r)),d(e,t,o-1)}return r}catch(r){if(s.DEBUG&&console.error("Erro no fetch:",r),o>0){let r=s.BACKOFF_BASE_MS*Math.pow(2,s.MAX_RETRIES-o);return s.DEBUG&&console.log("Network error, retry ".concat(s.MAX_RETRIES-o+1," for ").concat(e," after ").concat(r,"ms")),await new Promise(e=>setTimeout(e,r)),d(e,t,o-1)}return s.DEBUG&&console.error("Fetch failed after retries:",r),null}},u=()=>{let[e]=(0,n.useState)(s.ENABLED),[t,o]=(0,n.useState)(null),[a,c]=(0,n.useState)(!1),[u,E]=(0,n.useState)(!1),m=(0,n.useRef)(0),g=(0,n.useRef)(!1),p=(0,n.useRef)(""),f=(0,n.useRef)(!1);return((0,n.useEffect)(()=>{if(!f.current){f.current=!0,s.DEBUG&&console.log("Inicializando VisitTracker");try{let e=localStorage.getItem("deviceId")||crypto.randomUUID();localStorage.setItem("deviceId",e),p.current=e;let t=new Date;o(t),s.DEBUG&&console.log("Visita iniciada:",t)}catch(e){s.DEBUG&&console.error("Erro ao inicializar VisitTracker:",e)}}},[]),(0,n.useEffect)(()=>{if(!t||!p.current)return;(async()=>{if(!g.current){g.current=!0;try{let e={device_id:p.current,timestamp:t.toISOString(),user_agent:navigator.userAgent,referrer:document.referrer||"direct"},o="".concat(l(),"/visit/register");s.DEBUG&&console.log("Registrando visita:",o,e),await d(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},mode:"cors",credentials:"include",body:JSON.stringify(e)})}catch(e){s.DEBUG&&console.error("Erro ao registrar visita:",e)}finally{g.current=!1}}})();let e=async()=>{if(!t||g.current)return;let e=Date.now();if(!(e-m.current<6e4)){g.current=!0,m.current=e;try{let e=new Date,o=e.getTime()-t.getTime(),r=Math.floor(o/1e3);s.DEBUG&&console.log("Registrando tempo peri\xf3dico: ".concat(r," segundos"));let n={device_id:p.current,time_spent_seconds:r,timestamp:e.toISOString()},a="".concat(l(),"/visit/time");s.DEBUG&&console.log("Registrando tempo:",a,n),await d(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},mode:"cors",credentials:"include",body:JSON.stringify(n)})}catch(e){s.DEBUG&&console.error("Erro ao registrar tempo:",e)}finally{g.current=!1}}},o=()=>{if(s.DEBUG&&console.log("Evento beforeunload/pagehide detectado"),navigator.sendBeacon&&t){let e=new Date,o=Math.floor((e.getTime()-t.getTime())/1e3);s.DEBUG&&console.log("Registrando tempo na sa\xedda: ".concat(o," segundos"));let r={device_id:p.current,time_spent_seconds:o,timestamp:e.toISOString()},n="".concat(window.location.origin).concat(l(),"/visit/time");s.DEBUG&&console.log("Enviando beacon:",n,r),navigator.sendBeacon(n,JSON.stringify(r))}else e()};window.addEventListener("beforeunload",o),window.addEventListener("pagehide",o);let r=setInterval(()=>{s.DEBUG&&console.log("Intervalo peri\xf3dico de registro de tempo"),e()},s.INTERVAL_MS);return()=>{window.removeEventListener("beforeunload",o),window.removeEventListener("pagehide",o),clearInterval(r),e()}},[t]),(0,n.useEffect)(()=>{if(!u||!s.ENABLED)return;let e=()=>"true"===localStorage.getItem("dontShowExitModal");if(e())return;let t=t=>{!e()&&t.clientY<=0&&(s.DEBUG&&console.log("Mouse saiu pela parte superior da p\xe1gina, mostrando modal"),c(!0))};return document.addEventListener("mouseleave",t),()=>{document.removeEventListener("mouseleave",t)}},[u]),(0,n.useEffect)(()=>{if(!s.ENABLED)return;let e=()=>{u||(s.DEBUG&&console.log("Primeira intera\xe7\xe3o do usu\xe1rio detectada"),E(!0))};return document.addEventListener("click",e),document.addEventListener("scroll",e),()=>{document.removeEventListener("click",e),document.removeEventListener("scroll",e)}},[u]),e)?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(i,{isOpen:a,onClose:()=>c(!1)})}):null}},9099:(e,t,o)=>{e.exports=o(8253)}}]);